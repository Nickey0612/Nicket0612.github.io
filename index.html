<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>geolocation api test</title>
        <script>

            var id;

            function addMsg(_text) {
                //let text = _text + "</br>";
                document.getElementById("msg").textContent = _text;
            }

            function start() {
                if(navigator.geolocation) {
                    addMsg("位置情報を取得中");
                    var element = document.getElementById("button");
                    var event = function() { stop(); };
                    element.textContent = "stop";
                    element.onclick = event;
                    //gpsStart();
                }else{
                    addMsg("この端末では利用できません");
                }
            }

            function stop() {
                var element = document.getElementById("button");
                var event = function(){ start(); };
                element.textContent = "start";
                element.onclick = event;
                //gpsStop();
            }

            function gpsStart() {
                var op1 = document.getElementById("op1").checked;
                var op2 = Number(document.getElementById("op2").value);
                var op3 = Number(document.getElementById("op3").value);
                var option = {
                    enableHighAccuracy: op1,
                    maximumAge: op2,
                    timeout: op3
                };

                id = navigator.geolocation.watchPosition(
                    function(position) {
                        success(position);
                    },
                    function(error) {
                        err(error);
                    },
                    option
                );
            }

            function gpsStop() {
                navigator.geolocation.clearWatch(id);
            }

            function success(position) {
                var time = position.timestamp;
                var lat = position.coords.latitude;
                var lon = position.coords.longitude;
                var alt = position.coords.altitude;
                var acc = position.coords.accuracy;
                var speed = position.coords.speed;
            }

            function err(error) {
                var e = "";
                if(error.code == 1) {
                    e = "位置情報取得が許可されていません";
                }
                if(error.code == 2) {
                    e = "現在位置を取得出来ません";
                }
                if(error.code == 3) {
                    e = "位置情報取得がタイムアウトしました";
                }

                addMsg(e);
            }

        </script>
    </head>
    <body>
        enableHighAccuracy: <input type="checkbox" name="op1"> //より高精度な位置を求める<br>
        maximumAge: <input type="number" name="op2" style="width:50px;" value=0> // 最後の現在位置情報がこの値以内の場合は再利用(ms)<br>
        timeout: <input type="number" name="op3" style="width:50px;" value=5000> // この値以内に現在位置情報を取得出来ない場合は処理を終了(ms)<br>
        <button type="button" id="button" onclick="start()">start</button>
        <div id="msg" style="width:100%; height: 50px; overflow: scroll;"></div>
        <hr>
        <div id="data" style="width:100%; height: 100%; overflow: scroll; "></div>
    </body>
</html>
